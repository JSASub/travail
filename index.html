<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestion de Palanqu√©es JSAS</title>
  <link rel="stylesheet" href="styles.css" />
  
  <!-- Firebase SDK version 8 (compatible syntaxe classique) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  
  <!-- jsPDF pour l'export PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
  <!-- SECTION DE CONNEXION -->
  <div id="auth-section" style="display: none;">
    <div style="max-width: 400px; margin: 50px auto; padding: 30px; background: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
      <h2 style="text-align: center; color: #004080; margin-bottom: 30px;">ü§ø Connexion JSAS</h2>
      
      <form id="login-form">
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email :</label>
          <input type="email" id="email" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Mot de passe :</label>
          <input type="password" id="password" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
          <a href="reset_password.html" style="font-size:12px; opacity:0.8; text-decoration:underline; padding:4px 2px;">J'ai oubli√© mon mot de passe</a>
        </div>
        
        <button type="submit" style="width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">
          Se connecter
        </button>
      </form>
      
      <div id="auth-error" style="margin-top: 15px; padding: 10px; background: #f8d7da; color: #721c24; border-radius: 5px; display: none;"></div>
      <div id="auth-loading" style="margin-top: 15px; text-align: center; color: #666; display: none;">Connexion en cours...</div>
    </div>
  </div>

  <!-- APPLICATION PRINCIPALE -->
  <div id="main-app" style="display: block;">
    <header>
      <div style="display: flex; justify-content: flex-end; align-items: center; padding: 10px 0;">
        <div style="display: flex; align-items: center; gap: 10px;">
          <span id="user-info" style="color: #666; font-size: 14px;"></span>
          <button id="change-password-btn" style="padding: 5px 10px; background: #6f42c1; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;" title="Changer le mot de passe">
            üîë MdP
          </button>
          <button id="logout-btn" style="padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">
            D√©connexion
          </button>
        </div>
      </div>
      
      <div style="margin-top: 20px; margin-bottom: 15px;">
        <h2 style="text-align: left; margin: 0; color: #004080; font-size: 20px;">ü§ø Palanqu√©es JSAS</h2>
      </div>
      
      <hr>
      <div style="text-align: center; margin: 28px 0;">
        <h1 style="margin: 0; color: #004080;">Cr√©ation des<br>FICHES de S√âCURIT√â</h1>
      </div>
      <hr>
      
      <div id="meta-info">
        <div class="dp-management-container">
          <!-- Section de gauche : S√©lection DP -->
          <div class="dp-selection">
            <label><strong>Directeur de Plong√©e</strong></label>
            <select id="dp-select">
              <option value="">-- S√©lectionner un DP --</option>
            </select>
            <input type="text" id="dp-nom" placeholder="DP s√©lectionn√©" readonly style="margin-top: 5px; background: #f8f9fa;" />
          </div>
          
          <!-- Section de droite : Boutons de gestion -->
          <div class="dp-buttons">
            <button type="button" id="nouveau-dp" class="dp-btn dp-btn-success" title="Ajouter un nouveau DP">
              ‚ûï Nouveau DP
            </button>
            <button type="button" id="supprimer-dp" class="dp-btn dp-btn-danger" title="Supprimer le DP s√©lectionn√©">
              üóëÔ∏è Suppression
            </button>
            <button type="button" id="corriger-dp" class="dp-btn dp-btn-warning" title="Modifier le DP s√©lectionn√©">
              ‚úèÔ∏è Correction
            </button>
            <button type="button" id="raz-dp" class="dp-btn dp-btn-secondary" title="Remettre √† z√©ro la liste des DP">
              üîÑ RAZ
            </button>
          </div>
        </div>
        
        <!-- Autres champs DP -->
        <div class="dp-other-fields">
          <label>Date : <input type="date" id="date-dp" /></label>
          <label>Lieu : <input type="text" id="lieu-dp" placeholder="Lieu de plong√©e" /></label>
          <label>Plong√©e : 
            <select id="type-plongee">
              <option value="matin">Matin</option>
              <option value="apres-midi">Apr√®s-midi</option>
              <option value="soir">Soir</option>
              <option value="nuit">Nuit</option>
              <option value="plg1">Plg1</option>
              <option value="plg2">Plg2</option>
              <option value="plg3">Plg3</option>
              <option value="plg4">Plg4</option>
              <option value="formation">Formation</option>
              <option value="autre">Autre</option>
            </select>
          </label>
        </div>
        
        <button type="submit" id="valider-session">üíæ Valider Session</button>
        <div id="session-message" class="session-valide"></div>
      </div>
    </header>

    <!-- SECTION ALERTES -->
    <div id="alertes-section" class="alert-section alert-hidden">
      <div class="alert-title">‚ö†Ô∏è Alertes Palanqu√©es</div>
      <div id="alertes-content"></div>
    </div>

    <main>
      <br><br>
      <strong>Liste des plongeurs <span id="compteur-plongeurs" style="color: #007bff;">(0)</span></strong>
      
      <!-- CONTR√îLES DE TRI -->
      <div class="sort-controls">
        <span>Trier par :</span>
        <button class="sort-btn active" data-sort="none">Ordre d'ajout</button>
        <button class="sort-btn" data-sort="nom">Nom A-Z</button>
        <button class="sort-btn" data-sort="niveau">Niveau</button>
      </div>
      
      <form id="addForm">  
        <input type="text" id="nom" placeholder="NOM & Pr√©nom" required />
        <select id="niveau" required>
          <option value="">-- S√©lectionner le niveau --</option>
          <option>D√©b.</option>
          <option>Plg.Br</option>
          <option>Plg.Ar</option>
          <option>Plg.Or</option>
          <option>N1</option>
          <option>N2</option>
          <option>N3</option>
          <option>GP</option>
          <option>N4/GP</option>
          <option>E1</option>
          <option>E2</option>
          <option>E3</option>
          <option>E4</option>
        </select>
        
        Pr√©rogatives : 
        <input type="text" id="pre" placeholder="PE20, PA40 ..." />
        <br>
        <button type="submit" id="ajouter-plongeur">Ajouter</button>
      </form>

      <ul id="listePlongeurs" class="dropzone"></ul>
      <br>
      
      <button id="exportJSON" class="btn-success">Enregistrer la Liste des plongeurs JSON</button>
      <br>
      Charger la liste des plongeurs: <input type="file" id="importJSON" accept=".json" />

      <br><br><br><br><br><br>
      <section id="palanquees">
        <strong>Palanqu√©es <span id="compteur-palanquees" style="color: #28a745;">(0 plongeurs dans 0 palanqu√©es)</span></strong>
        <br>
        <button id="addPalanquee">Nouvelle palanqu√©e</button>
        <br><br>    
        <div id="palanqueesContainer"></div>
        
        <br><br>
        <button id="preview-html" class="btn-secondary">Aper√ßu HTML</button>
        <button id="export-pdf" class="btn-success">T√©l√©charger PDF</button>
       </section>
    </main>

    <br><br><br>
    <hr>
    <section id="sessions-manager">
      <strong>Gestion des Sessions</strong>
      <div style="margin: 10px 0;">
        <label>Charger une session pr√©c√©dente :</label>
        <select id="session-selector" style="margin: 5px 10px;">
          <option value="">-- Charger une session --</option>
        </select>
        <button id="load-session" class="btn-secondary">Charger</button>
        <button id="refresh-sessions" class="btn-secondary">Actualiser</button>
        <button id="save-session" class="btn-success">Sauvegarder Session</button>
        <button id="test-firebase" style="background: orange; color: white;">Test Firebase</button>
      </div>
      <div style="margin: 10px 0; font-size: 0.9em; color: #666;">
        Les sessions sont automatiquement sauvegard√©es par date et directeur de plong√©e.
      </div>
    </section>
    
    <hr>
    
    <footer style="text-align: center; font-size: 0.8em; padding: 20px;">
    Version 3.1.0 - RA - 2025 - JSA Subaquatique
    </footer>

  </div> <!-- Fin main-app -->

  <!-- Modal pour ajouter/modifier un DP -->
  <div id="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000;"></div>
  <div id="dp-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 10001; min-width: 400px;">
    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
      <h3 id="modal-title" style="margin: 0; color: #004080;">Nouveau DP</h3>
      <button id="modal-close" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group" style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nom & Pr√©nom :</label>
        <input type="text" id="modal-nom" placeholder="AGUIRRE Raoul" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" />
      </div>
      <div class="form-group" style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Niveau :</label>
        <select id="modal-niveau" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
          <option value="">-- S√©lectionner --</option>
          <option value="E4">E4</option>
          <option value="E3">E3</option>
          <option value="P5">P5</option>
        </select>
      </div>
      <div class="form-group" style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email :</label>
        <input type="email" id="modal-email" placeholder="raoul.aguirre64@gmail.com" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" />
      </div>
      <div class="form-actions" style="display: flex; gap: 10px; justify-content: flex-end;">
        <button type="button" id="modal-cancel" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">Annuler</button>
        <button type="button" id="modal-submit" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">üíæ Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Scripts JavaScript modulaires - ORDRE IMPORTANT -->
  <script src="config-firebase.js"></script>
  <script src="ui-interface.js"></script>
  <script src="render-dom.js"></script>
  <script src="main-complete.js"></script>
  <script src="simple-lock-system.js"></script>
  <script src="offline-manager.js"></script>
  <script src="password-manager.js"></script>  
  <script src="dp-online-manager.js"></script>  
</body>
</html>